<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8 />
	<title>Mapov</title>
	<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
	<link rel="shortcut icon" href="/favicon.ico">
	<link href="/home/francisco/selp/SELP//static/dist/css/bootstrap.css" rel="stylesheet">
	<link href="/home/francisco/selp/SELP//static/css/project.css" rel="stylesheet">
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.js'></script>
	<!-- <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.css' rel='stylesheet' /> -->
	<script src="/home/francisco/selp/SELP/static/jquery-1.11.1.min.js"></script>
	<link rel="stylesheet" href="/home/francisco/selp/SELP/static/leaflet/leaflet.css" />
	<style>
	  html, body, .container-fluid, .content, .content > * {
    height: 100% !important;}
	  #map {
    height: 100% !important;
    margin-top: -1em;
    margin-bottom: 1em;}
	</style>
</head>
<body>
<nav class="navbar navbar-default">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="#"><img src="/home/francisco/selp/SELP/static/img/brand.png" width="60"></a>
          <a class="navbar-brand" href="#">M@pov</a>
        </div>
        <div>
          <ul class="nav navbar-nav">
            <li><a href="#">About</a></li>
            <li><a href="#">Sign in</a></li>
          </ul>
        </div>
      <div class="nav navbar-right navbar-collapse collapse">
        <a href="/" class="btn btn-primary navbar-btn">Craft Path</a>
      </div>
      <form class="navbar-form navbar-left" role="search">
          <div class="form-group">
              <input type="text" class="form-control" placeholder="Start point">
          </div>
      </form>
      <form class="navbar-form navbar-left" role="search">
          <div class="form-group">
              <input type="text" class="form-control" placeholder="End point">
          </div>
          <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-search"></span></button>
      </form>
      </div>
    </nav>
<!-- 
    <div class="container-fluid">
        <div id="map" class="leaflet-container leaflet-fade-anim" style="position: relative;" tabindex="0"></div>
        </div> -->
<link href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.2.2/leaflet.draw.css' rel='stylesheet' />
<script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-draw/v0.2.2/leaflet.draw.js'></script>

	<div id='map'></div>
<!-- 	<script src="/home/francisco/selp/SELP/static/leaflet/leaflet.js"></script> -->
	<script>
		L.mapbox.accessToken = 'pk.eyJ1IjoidmFyZ2ZyYW4iLCJhIjoiRW44bEMyQSJ9.i3kosn_djpsoR6Qy4TO0Vw#15';
		var southWest = L.latLng(55.874962, -3.404167),
		    northEast = L.latLng(55.988625, -3.096550),
		    bounds = L.latLngBounds(southWest, northEast);
		var map = L.mapbox.map('map', 'vargfran.b9bd48fd', {
    maxBounds: bounds,
    maxZoom: 19,
    minZoom: 10
})
		    .setView([ 55.944, -3.192], 15);
    var featureGroup = L.featureGroup().addTo(map);

	var circle_options = {
      color: '#fff',      // Stroke color
      opacity: 1,         // Stroke opacity
      weight: 1,         // Stroke weight
      fillColor: '#F00',  // Fill color
      fillOpacity: 1    // Fill opacity
  };

   var circle_one = L.circle([ 55.944, -3.192], 20, circle_options).addTo(featureGroup);
    var drawControl = new L.Control.Draw({
    edit: {
      featureGroup: featureGroup
    }
  }).addTo(map);

	map.on('draw:created', function(e) {
	  featureGroup.addLayer(e.layer);
	});

	var popup = L.popup();

	// Parse lat long 
	function parseLatLong(latStr){
		var n = latStr.length;
		var outStr = "";
		for(i = 0; i < n; i ++){
			if(!isNaN(latStr[i]) || latStr[i]===',' || latStr[i]==='.'  || latStr[i]==='-' ){
				outStr += latStr[i];
			}
		}
		return outStr;
	};

	// String.format function to be used 
	// for address fetching
	String.prototype.format = function() {
    var formatted = this;
    for( var arg in arguments ) {
        formatted = formatted.replace("{" + arg + "}", arguments[arg]);
    }
    return formatted;
    };

    function getAddress(e){
    	var latLong = parseLatLong(e.latlng.toString()).split(",");
    	//console.log(latLong);
    	var api_call = "http://maps.googleapis.com/maps/api/geocode/json?latlng={0},{1}&sensor=true"
    	var url = api_call.format(latLong[0],latLong[1]);
    	console.log(url);
    	jQuery.getJSON(url).done([function(data){ 
    			var address = data["results"][0]["formatted_address"];
    			popup
			.setLatLng(e.latlng)
			.setContent(address)
			.openOn(map);

    			}]);
    }

	map.on('click', getAddress);

	</script>

</body>
</html>

